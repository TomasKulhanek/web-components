{"version":3,"file":"aurelia-web-components.js","sources":["../../src/utilities.ts","../../src/custom-element-utilities.ts","../../src/custom-element-registry.ts"],"sourcesContent":["import { HtmlBehaviorResource } from 'aurelia-templating';\n\nexport const defineProperty = Reflect.defineProperty;\nexport const tagNameOf = (behavior: HtmlBehaviorResource) => behavior.elementName || behavior.target.name;\n\nconst sharedPropertyDescriptor = {\n  enumerable: false,\n  configurable: true,\n  get: undefined,\n  set: undefined\n} as PropertyDescriptor;\n\nexport const definePrototypeGetterSetter = <T extends object = object>(obj: T, propertyName: string, getter: () => any, setter: (val: any) => any): T => {\n  sharedPropertyDescriptor.get = getter;\n  sharedPropertyDescriptor.set = setter;\n  defineProperty(obj, propertyName, sharedPropertyDescriptor);\n  sharedPropertyDescriptor.get = sharedPropertyDescriptor.set = undefined;\n  return obj;\n};\n","import {\n  HtmlBehaviorResource,\n  BehaviorInstruction,\n  TargetInstruction,\n  ViewResources,\n  ViewSlot,\n  BoundViewFactory,\n  Controller,\n  View,\n  ViewCompiler\n} from 'aurelia-templating';\n\nimport {\n  Binding,\n  Scope,\n  InternalPropertyObserver\n} from 'aurelia-binding';\n\nimport {\n  Container\n} from 'aurelia-dependency-injection';\n\nimport {\n  DOM\n} from 'aurelia-pal';\n\nimport {\n  IGetterFunction\n} from './interface';\n\nimport {\n  definePrototypeGetterSetter,\n  defineProperty\n} from './utilities';\n\nconst emptyArray = Object.freeze([]) as any[];\n\nexport const createWebComponentClassFromBehavior = (\n  container: Container,\n  behavior: HtmlBehaviorResource,\n  viewResources: ViewResources,\n  compiler: ViewCompiler\n) => {\n\n  const CustomElementClass = class extends HTMLElement {\n\n    /**@internal */\n    _children: View[];\n    /**@internal */\n    _bindings: Binding[];\n    /**@internal */\n    au: { controller: Controller; };\n    /**@internal */\n    initialized: boolean;\n\n    constructor() {\n      super();\n      this.initialized = false;\n    }\n\n    auInit(): void {\n      if (this.initialized) {\n        return;\n      }\n\n      this.initialized = true;\n\n      const behaviorInstruction = BehaviorInstruction.element(this, behavior);\n      const attributes = this.attributes;\n      const children = this._children = [];\n      const bindings = this._bindings = [];\n\n      behavior.processAttributes(compiler, viewResources, this, attributes, behaviorInstruction);\n\n      for (let i = 0, ii = attributes.length; i < ii; ++i) {\n        const attr = attributes[i];\n        behaviorInstruction.attributes[attr.name] = attr.value;\n      }\n\n      behavior.compile(compiler, viewResources, this, behaviorInstruction, this.parentNode);\n\n      const targetInstruction = TargetInstruction.normal(\n        0,\n        0,\n        [behavior.target],\n        [behaviorInstruction],\n        /*no expression*/emptyArray,\n        behaviorInstruction\n      );\n\n      const childContainer = createElementContainer(\n        container,\n        this,\n        targetInstruction,\n        children,\n        behaviorInstruction.partReplacements,\n        viewResources\n      );\n\n      const controller = behavior.create(childContainer, behaviorInstruction, this, bindings);\n      controller.created(null);\n    }\n\n    connectedCallback(): void {\n      this.auInit();\n      let scope = { bindingContext: this, overrideContext: {} } as Scope;\n      this.au.controller.bind(scope);\n      this._bindings.forEach(x => x.bind(scope));\n      this._children.forEach(x => x.bind(scope.bindingContext, scope.overrideContext, true));\n\n      this.au.controller.attached();\n      this._children.forEach(x => x.attached());\n    }\n\n    disconnectedCallback(): void {\n      this.au.controller.detached();\n      this._children.forEach(x => x.detached());\n\n      this.au.controller.unbind();\n      this._bindings.forEach(x => x.unbind());\n      this._children.forEach(x => x.unbind());\n    }\n\n    attributeChangedCallback(attrName: string, oldValue: string, newValue: string): void {\n      this.auInit();\n      const bindable = behavior.attributes[attrName];\n      if (bindable !== undefined) {\n        this.au.controller.viewModel[bindable.name] = newValue;\n      }\n    }\n  };\n\n  const CustomElementViewModelClass = behavior.target;\n  const proto = CustomElementClass.prototype;\n  const observedAttributes: string[] = [];\n\n  behavior.properties.forEach(bindableProperty => {\n\n    const getterFn = function () {\n      return this.au.controller.viewModel[bindableProperty.name];\n    } as IGetterFunction;\n\n    getterFn.getObserver = function(obj: any) {\n      return getObserver(container, behavior, obj.au.controller.viewModel, bindableProperty.name);\n    };\n\n    definePrototypeGetterSetter(\n      proto,\n      bindableProperty.name,\n      getterFn,\n      function (value: unknown) {\n        this.au.controller.viewModel[bindableProperty.name] = value;\n      }\n    );\n\n    observedAttributes.push(bindableProperty.attribute);\n  });\n\n  defineProperty(CustomElementClass, 'observedAttributes', {\n    get: () => observedAttributes\n  });\n\n  // Object\n  //   .keys(CustomElementViewModelClass.prototype)\n  //   .forEach(key => {\n  //     const descriptor = Reflect.getOwnPropertyDescriptor(CustomElementViewModelClass.prototype, key);\n  //     if (typeof descriptor.value === 'function') {\n  //       proto[key] = function (...args: any[]) {\n  //         return this.au.controller.viewModel[key](...args);\n  //       };\n  //     }\n  //   });\n\n  return CustomElementClass;\n};\n\nconst getObserver = (\n  container: Container,\n  behavior: HtmlBehaviorResource,\n  instance: object & { __observers__: any; },\n  name: string\n): InternalPropertyObserver => {\n  let lookup = instance.__observers__;\n\n  if (lookup === undefined) {\n    if (!behavior.isInitialized) {\n      behavior.initialize(container, instance.constructor);\n    }\n\n    lookup = behavior.observerLocator.getOrCreateObserversLookup(instance);\n    behavior._ensurePropertiesDefined(instance, lookup);\n  }\n\n  return lookup[name];\n};\n\nfunction elementContainerGet(this: Container, key: any): any {\n  if (key === DOM.Element) {\n    return this.element;\n  }\n\n  if (key === BoundViewFactory) {\n    if (this.boundViewFactory) {\n      return this.boundViewFactory;\n    }\n\n    let factory = this.instruction.viewFactory;\n    let partReplacements = this.partReplacements;\n\n    if (partReplacements) {\n      factory = partReplacements[factory.part] || factory;\n    }\n\n    this.boundViewFactory = new BoundViewFactory(this, factory, partReplacements);\n    return this.boundViewFactory;\n  }\n\n  if (key === ViewSlot) {\n    if (this.viewSlot === undefined) {\n      this.viewSlot = new ViewSlot(this.element, this.instruction.anchorIsContainer);\n      this.element.isContentProjectionSource = this.instruction.lifting;\n      this.children.push(this.viewSlot);\n    }\n\n    return this.viewSlot;\n  }\n\n  if (key === ViewResources) {\n    return this.viewResources;\n  }\n\n  if (key === TargetInstruction) {\n    return this.instruction;\n  }\n\n  return this.superGet(key);\n}\n\nconst createElementContainer = (\n  parent: Container,\n  element: Element,\n  instruction: TargetInstruction,\n  children: View[],\n  partReplacements: Record<string, any>,\n  resources: ViewResources\n): Container => {\n  const container = parent.createChild();\n  const provider = instruction.providers[0];\n\n  container.element = element as Element & { isContentProjectionSource: boolean };\n  container.instruction = instruction;\n  container.children = children;\n  container.viewResources = resources;\n  container.partReplacements = partReplacements;\n\n  container.registerSingleton(provider, provider);\n\n  container.superGet = container.get;\n  container.get = elementContainerGet;\n\n  return container;\n};\n","import { Container } from 'aurelia-dependency-injection';\nimport { HtmlBehaviorResource, ViewCompiler, ViewResources, ViewFactory } from 'aurelia-templating';\nimport { createWebComponentClassFromBehavior } from './custom-element-utilities';\nimport './interface';\nimport { ICustomElementInfo, ICustomHtmlRegistry } from './interface';\nimport { tagNameOf } from './utilities';\nimport { metadata } from 'aurelia-metadata';\n\nexport class CustomElementRegistry implements ICustomHtmlRegistry {\n\n  static inject = [Container, ViewCompiler, ViewResources];\n\n  /**\n   * Custom element name must have hyphen. With custom elements that do not have, prefix with `au-`\n   */\n  fallbackPrefix: string;\n\n  /**@internal */\n  private _lookup: Record<string, ICustomElementInfo>;\n\n  /**@internal */\n  private container: Container;\n\n  /**@internal */\n  private viewCompiler: ViewCompiler;\n\n  /**@internal */\n  private viewResources: ViewResources;\n\n  constructor(container: Container, viewCompiler: ViewCompiler, viewResources: ViewResources) {\n    this.fallbackPrefix = 'au-';\n    this._lookup = Object.create(null);\n    this.container = container;\n    this.viewCompiler = viewCompiler;\n    this.viewResources = viewResources;\n  }\n\n  /**\n   * Use all global elements from current view resources and define them as native custom element\n   */\n  useGlobalElements(): Function[] {\n    const viewResources = this.viewResources;\n    // store reference to all existing global resources\n    const elements = viewResources.elements;\n    // remove all global element resources\n    viewResources.elements = Object.create(null);\n\n    return Object.keys(elements).map(tagName => {\n      const behavior = elements[tagName];\n      return this.registerBehavior(behavior, tagName).classDefinition;\n    });\n  }\n\n  /**@internal */\n  registerBehavior(behavior: HtmlBehaviorResource, tagName?: string): ICustomElementInfo {\n    const classDefinition = createWebComponentClassFromBehavior(\n      this.container,\n      behavior,\n      this.viewResources,\n      this.viewCompiler\n    );\n    tagName = tagName || tagNameOf(behavior);\n\n    const info: ICustomElementInfo = this._lookup[tagName] = {\n      tagName: tagName,\n      behavior: behavior,\n      classDefinition: classDefinition\n    };\n\n    //make fallbackPrefix obligatory //if (tagName.indexOf('-') === -1) {\n      tagName = this.fallbackPrefix + tagName;\n    //}\n\n    customElements.define(tagName, classDefinition);\n\n    return info;\n  }\n\n  register(Type: Function): Promise<Function> {\n    let htmlBehaviorResource = metadata.get(metadata.resource, Type) as HtmlBehaviorResource;\n    // validating metadata\n    if (htmlBehaviorResource) {\n      ViewResources.convention(Type, htmlBehaviorResource);\n    } else {\n      htmlBehaviorResource = ViewResources.convention(Type) as HtmlBehaviorResource;\n    }\n    if (!(htmlBehaviorResource instanceof HtmlBehaviorResource) || htmlBehaviorResource.elementName === null) {\n      throw new Error(`class ${Type.name} is already associated with a different type of resource. Cannot register as a custom element.`);\n    }\n\n    const customElementInfo = this.registerBehavior(htmlBehaviorResource, Type['is']);\n    return htmlBehaviorResource\n      .load(this.container, Type)\n      .then(() => customElementInfo.classDefinition);\n  }\n\n  has(Type: Function): boolean {\n    let htmlBehaviorResource = metadata.get(metadata.resource, Type) as HtmlBehaviorResource;\n    if (!htmlBehaviorResource || !(htmlBehaviorResource instanceof HtmlBehaviorResource)) {\n      return false;\n    }\n    return this._lookup[tagNameOf(htmlBehaviorResource)] !== undefined;\n  }\n}\n"],"names":["tslib_1.__extends"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;YAEO,IAAM,cAAc,GAAG,OAAO,CAAC,cAAc,CAAC;AACrD,YAAO,IAAM,SAAS,GAAG,UAAC,QAA8B,IAAK,OAAA,QAAQ,CAAC,WAAW,IAAI,QAAQ,CAAC,MAAM,CAAC,IAAI,GAAA,CAAC;YAE1G,IAAM,wBAAwB,GAAG;gBAC/B,UAAU,EAAE,KAAK;gBACjB,YAAY,EAAE,IAAI;gBAClB,GAAG,EAAE,SAAS;gBACd,GAAG,EAAE,SAAS;aACO,CAAC;AAExB,YAAO,IAAM,2BAA2B,GAAG,UAA4B,GAAM,EAAE,YAAoB,EAAE,MAAiB,EAAE,MAAyB;gBAC/I,wBAAwB,CAAC,GAAG,GAAG,MAAM,CAAC;gBACtC,wBAAwB,CAAC,GAAG,GAAG,MAAM,CAAC;gBACtC,cAAc,CAAC,GAAG,EAAE,YAAY,EAAE,wBAAwB,CAAC,CAAC;gBAC5D,wBAAwB,CAAC,GAAG,GAAG,wBAAwB,CAAC,GAAG,GAAG,SAAS,CAAC;gBACxE,OAAO,GAAG,CAAC;YACb,CAAC,CAAC;;YCiBF,IAAM,UAAU,GAAG,MAAM,CAAC,MAAM,CAAC,EAAE,CAAU,CAAC;AAE9C,YAAO,IAAM,mCAAmC,GAAG,UACjD,SAAoB,EACpB,QAA8B,EAC9B,aAA4B,EAC5B,QAAsB;gBAGtB,IAAM,kBAAkB;oBAAiBA,2BAAW;oBAWlD;wBAAA,YACE,iBAAO,SAER;wBADC,KAAI,CAAC,WAAW,GAAG,KAAK,CAAC;;qBAC1B;oBAED,wBAAM,GAAN;wBACE,IAAI,IAAI,CAAC,WAAW,EAAE;4BACpB,OAAO;yBACR;wBAED,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC;wBAExB,IAAM,mBAAmB,GAAG,mBAAmB,CAAC,OAAO,CAAC,IAAI,EAAE,QAAQ,CAAC,CAAC;wBACxE,IAAM,UAAU,GAAG,IAAI,CAAC,UAAU,CAAC;wBACnC,IAAM,QAAQ,GAAG,IAAI,CAAC,SAAS,GAAG,EAAE,CAAC;wBACrC,IAAM,QAAQ,GAAG,IAAI,CAAC,SAAS,GAAG,EAAE,CAAC;wBAErC,QAAQ,CAAC,iBAAiB,CAAC,QAAQ,EAAE,aAAa,EAAE,IAAI,EAAE,UAAU,EAAE,mBAAmB,CAAC,CAAC;wBAE3F,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,EAAE,GAAG,UAAU,CAAC,MAAM,EAAE,CAAC,GAAG,EAAE,EAAE,EAAE,CAAC,EAAE;4BACnD,IAAM,IAAI,GAAG,UAAU,CAAC,CAAC,CAAC,CAAC;4BAC3B,mBAAmB,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,IAAI,CAAC,KAAK,CAAC;yBACxD;wBAED,QAAQ,CAAC,OAAO,CAAC,QAAQ,EAAE,aAAa,EAAE,IAAI,EAAE,mBAAmB,EAAE,IAAI,CAAC,UAAU,CAAC,CAAC;wBAEtF,IAAM,iBAAiB,GAAG,iBAAiB,CAAC,MAAM,CAChD,CAAC,EACD,CAAC,EACD,CAAC,QAAQ,CAAC,MAAM,CAAC,EACjB,CAAC,mBAAmB,CAAC,EACJ,UAAU,EAC3B,mBAAmB,CACpB,CAAC;wBAEF,IAAM,cAAc,GAAG,sBAAsB,CAC3C,SAAS,EACT,IAAI,EACJ,iBAAiB,EACjB,QAAQ,EACR,mBAAmB,CAAC,gBAAgB,EACpC,aAAa,CACd,CAAC;wBAEF,IAAM,UAAU,GAAG,QAAQ,CAAC,MAAM,CAAC,cAAc,EAAE,mBAAmB,EAAE,IAAI,EAAE,QAAQ,CAAC,CAAC;wBACxF,UAAU,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;qBAC1B;oBAED,mCAAiB,GAAjB;wBACE,IAAI,CAAC,MAAM,EAAE,CAAC;wBACd,IAAI,KAAK,GAAG,EAAE,cAAc,EAAE,IAAI,EAAE,eAAe,EAAE,EAAE,EAAW,CAAC;wBACnE,IAAI,CAAC,EAAE,CAAC,UAAU,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;wBAC/B,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,UAAA,CAAC,IAAI,OAAA,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,GAAA,CAAC,CAAC;wBAC3C,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,UAAA,CAAC,IAAI,OAAA,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,cAAc,EAAE,KAAK,CAAC,eAAe,EAAE,IAAI,CAAC,GAAA,CAAC,CAAC;wBAEvF,IAAI,CAAC,EAAE,CAAC,UAAU,CAAC,QAAQ,EAAE,CAAC;wBAC9B,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,UAAA,CAAC,IAAI,OAAA,CAAC,CAAC,QAAQ,EAAE,GAAA,CAAC,CAAC;qBAC3C;oBAED,sCAAoB,GAApB;wBACE,IAAI,CAAC,EAAE,CAAC,UAAU,CAAC,QAAQ,EAAE,CAAC;wBAC9B,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,UAAA,CAAC,IAAI,OAAA,CAAC,CAAC,QAAQ,EAAE,GAAA,CAAC,CAAC;wBAE1C,IAAI,CAAC,EAAE,CAAC,UAAU,CAAC,MAAM,EAAE,CAAC;wBAC5B,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,UAAA,CAAC,IAAI,OAAA,CAAC,CAAC,MAAM,EAAE,GAAA,CAAC,CAAC;wBACxC,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,UAAA,CAAC,IAAI,OAAA,CAAC,CAAC,MAAM,EAAE,GAAA,CAAC,CAAC;qBACzC;oBAED,0CAAwB,GAAxB,UAAyB,QAAgB,EAAE,QAAgB,EAAE,QAAgB;wBAC3E,IAAI,CAAC,MAAM,EAAE,CAAC;wBACd,IAAM,QAAQ,GAAG,QAAQ,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC;wBAC/C,IAAI,QAAQ,KAAK,SAAS,EAAE;4BAC1B,IAAI,CAAC,EAAE,CAAC,UAAU,CAAC,SAAS,CAAC,QAAQ,CAAC,IAAI,CAAC,GAAG,QAAQ,CAAC;yBACxD;qBACF;oBACH,cAAC;iBAAA,CAtFwC,WAAW,EAsFnD,CAAC;gBAEF,IAAM,2BAA2B,GAAG,QAAQ,CAAC,MAAM,CAAC;gBACpD,IAAM,KAAK,GAAG,kBAAkB,CAAC,SAAS,CAAC;gBAC3C,IAAM,kBAAkB,GAAa,EAAE,CAAC;gBAExC,QAAQ,CAAC,UAAU,CAAC,OAAO,CAAC,UAAA,gBAAgB;oBAE1C,IAAM,QAAQ,GAAG;wBACf,OAAO,IAAI,CAAC,EAAE,CAAC,UAAU,CAAC,SAAS,CAAC,gBAAgB,CAAC,IAAI,CAAC,CAAC;qBACzC,CAAC;oBAErB,QAAQ,CAAC,WAAW,GAAG,UAAS,GAAQ;wBACtC,OAAO,WAAW,CAAC,SAAS,EAAE,QAAQ,EAAE,GAAG,CAAC,EAAE,CAAC,UAAU,CAAC,SAAS,EAAE,gBAAgB,CAAC,IAAI,CAAC,CAAC;qBAC7F,CAAC;oBAEF,2BAA2B,CACzB,KAAK,EACL,gBAAgB,CAAC,IAAI,EACrB,QAAQ,EACR,UAAU,KAAc;wBACtB,IAAI,CAAC,EAAE,CAAC,UAAU,CAAC,SAAS,CAAC,gBAAgB,CAAC,IAAI,CAAC,GAAG,KAAK,CAAC;qBAC7D,CACF,CAAC;oBAEF,kBAAkB,CAAC,IAAI,CAAC,gBAAgB,CAAC,SAAS,CAAC,CAAC;iBACrD,CAAC,CAAC;gBAEH,cAAc,CAAC,kBAAkB,EAAE,oBAAoB,EAAE;oBACvD,GAAG,EAAE,cAAM,OAAA,kBAAkB,GAAA;iBAC9B,CAAC,CAAC;gBAaH,OAAO,kBAAkB,CAAC;YAC5B,CAAC,CAAC;YAEF,IAAM,WAAW,GAAG,UAClB,SAAoB,EACpB,QAA8B,EAC9B,QAA0C,EAC1C,IAAY;gBAEZ,IAAI,MAAM,GAAG,QAAQ,CAAC,aAAa,CAAC;gBAEpC,IAAI,MAAM,KAAK,SAAS,EAAE;oBACxB,IAAI,CAAC,QAAQ,CAAC,aAAa,EAAE;wBAC3B,QAAQ,CAAC,UAAU,CAAC,SAAS,EAAE,QAAQ,CAAC,WAAW,CAAC,CAAC;qBACtD;oBAED,MAAM,GAAG,QAAQ,CAAC,eAAe,CAAC,0BAA0B,CAAC,QAAQ,CAAC,CAAC;oBACvE,QAAQ,CAAC,wBAAwB,CAAC,QAAQ,EAAE,MAAM,CAAC,CAAC;iBACrD;gBAED,OAAO,MAAM,CAAC,IAAI,CAAC,CAAC;YACtB,CAAC,CAAC;YAEF,SAAS,mBAAmB,CAAkB,GAAQ;gBACpD,IAAI,GAAG,KAAK,GAAG,CAAC,OAAO,EAAE;oBACvB,OAAO,IAAI,CAAC,OAAO,CAAC;iBACrB;gBAED,IAAI,GAAG,KAAK,gBAAgB,EAAE;oBAC5B,IAAI,IAAI,CAAC,gBAAgB,EAAE;wBACzB,OAAO,IAAI,CAAC,gBAAgB,CAAC;qBAC9B;oBAED,IAAI,OAAO,GAAG,IAAI,CAAC,WAAW,CAAC,WAAW,CAAC;oBAC3C,IAAI,gBAAgB,GAAG,IAAI,CAAC,gBAAgB,CAAC;oBAE7C,IAAI,gBAAgB,EAAE;wBACpB,OAAO,GAAG,gBAAgB,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,OAAO,CAAC;qBACrD;oBAED,IAAI,CAAC,gBAAgB,GAAG,IAAI,gBAAgB,CAAC,IAAI,EAAE,OAAO,EAAE,gBAAgB,CAAC,CAAC;oBAC9E,OAAO,IAAI,CAAC,gBAAgB,CAAC;iBAC9B;gBAED,IAAI,GAAG,KAAK,QAAQ,EAAE;oBACpB,IAAI,IAAI,CAAC,QAAQ,KAAK,SAAS,EAAE;wBAC/B,IAAI,CAAC,QAAQ,GAAG,IAAI,QAAQ,CAAC,IAAI,CAAC,OAAO,EAAE,IAAI,CAAC,WAAW,CAAC,iBAAiB,CAAC,CAAC;wBAC/E,IAAI,CAAC,OAAO,CAAC,yBAAyB,GAAG,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC;wBAClE,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;qBACnC;oBAED,OAAO,IAAI,CAAC,QAAQ,CAAC;iBACtB;gBAED,IAAI,GAAG,KAAK,aAAa,EAAE;oBACzB,OAAO,IAAI,CAAC,aAAa,CAAC;iBAC3B;gBAED,IAAI,GAAG,KAAK,iBAAiB,EAAE;oBAC7B,OAAO,IAAI,CAAC,WAAW,CAAC;iBACzB;gBAED,OAAO,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC;YAC5B,CAAC;YAED,IAAM,sBAAsB,GAAG,UAC7B,MAAiB,EACjB,OAAgB,EAChB,WAA8B,EAC9B,QAAgB,EAChB,gBAAqC,EACrC,SAAwB;gBAExB,IAAM,SAAS,GAAG,MAAM,CAAC,WAAW,EAAE,CAAC;gBACvC,IAAM,QAAQ,GAAG,WAAW,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC;gBAE1C,SAAS,CAAC,OAAO,GAAG,OAA2D,CAAC;gBAChF,SAAS,CAAC,WAAW,GAAG,WAAW,CAAC;gBACpC,SAAS,CAAC,QAAQ,GAAG,QAAQ,CAAC;gBAC9B,SAAS,CAAC,aAAa,GAAG,SAAS,CAAC;gBACpC,SAAS,CAAC,gBAAgB,GAAG,gBAAgB,CAAC;gBAE9C,SAAS,CAAC,iBAAiB,CAAC,QAAQ,EAAE,QAAQ,CAAC,CAAC;gBAEhD,SAAS,CAAC,QAAQ,GAAG,SAAS,CAAC,GAAG,CAAC;gBACnC,SAAS,CAAC,GAAG,GAAG,mBAAmB,CAAC;gBAEpC,OAAO,SAAS,CAAC;YACnB,CAAC,CAAC;;;gBCxOA,+BAAY,SAAoB,EAAE,YAA0B,EAAE,aAA4B;oBACxF,IAAI,CAAC,cAAc,GAAG,KAAK,CAAC;oBAC5B,IAAI,CAAC,OAAO,GAAG,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;oBACnC,IAAI,CAAC,SAAS,GAAG,SAAS,CAAC;oBAC3B,IAAI,CAAC,YAAY,GAAG,YAAY,CAAC;oBACjC,IAAI,CAAC,aAAa,GAAG,aAAa,CAAC;iBACpC;gBAKD,iDAAiB,GAAjB;oBAAA,iBAWC;oBAVC,IAAM,aAAa,GAAG,IAAI,CAAC,aAAa,CAAC;oBAEzC,IAAM,QAAQ,GAAG,aAAa,CAAC,QAAQ,CAAC;oBAExC,aAAa,CAAC,QAAQ,GAAG,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;oBAE7C,OAAO,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,GAAG,CAAC,UAAA,OAAO;wBACtC,IAAM,QAAQ,GAAG,QAAQ,CAAC,OAAO,CAAC,CAAC;wBACnC,OAAO,KAAI,CAAC,gBAAgB,CAAC,QAAQ,EAAE,OAAO,CAAC,CAAC,eAAe,CAAC;qBACjE,CAAC,CAAC;iBACJ;gBAGD,gDAAgB,GAAhB,UAAiB,QAA8B,EAAE,OAAgB;oBAC/D,IAAM,eAAe,GAAG,mCAAmC,CACzD,IAAI,CAAC,SAAS,EACd,QAAQ,EACR,IAAI,CAAC,aAAa,EAClB,IAAI,CAAC,YAAY,CAClB,CAAC;oBACF,OAAO,GAAG,OAAO,IAAI,SAAS,CAAC,QAAQ,CAAC,CAAC;oBAEzC,IAAM,IAAI,GAAuB,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,GAAG;wBACvD,OAAO,EAAE,OAAO;wBAChB,QAAQ,EAAE,QAAQ;wBAClB,eAAe,EAAE,eAAe;qBACjC,CAAC;oBAGA,OAAO,GAAG,IAAI,CAAC,cAAc,GAAG,OAAO,CAAC;oBAG1C,cAAc,CAAC,MAAM,CAAC,OAAO,EAAE,eAAe,CAAC,CAAC;oBAEhD,OAAO,IAAI,CAAC;iBACb;gBAED,wCAAQ,GAAR,UAAS,IAAc;oBACrB,IAAI,oBAAoB,GAAG,QAAQ,CAAC,GAAG,CAAC,QAAQ,CAAC,QAAQ,EAAE,IAAI,CAAyB,CAAC;oBAEzF,IAAI,oBAAoB,EAAE;wBACxB,aAAa,CAAC,UAAU,CAAC,IAAI,EAAE,oBAAoB,CAAC,CAAC;qBACtD;yBAAM;wBACL,oBAAoB,GAAG,aAAa,CAAC,UAAU,CAAC,IAAI,CAAyB,CAAC;qBAC/E;oBACD,IAAI,EAAE,oBAAoB,YAAY,oBAAoB,CAAC,IAAI,oBAAoB,CAAC,WAAW,KAAK,IAAI,EAAE;wBACxG,MAAM,IAAI,KAAK,CAAC,WAAS,IAAI,CAAC,IAAI,mGAAgG,CAAC,CAAC;qBACrI;oBAED,IAAM,iBAAiB,GAAG,IAAI,CAAC,gBAAgB,CAAC,oBAAoB,EAAE,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;oBAClF,OAAO,oBAAoB;yBACxB,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE,IAAI,CAAC;yBAC1B,IAAI,CAAC,cAAM,OAAA,iBAAiB,CAAC,eAAe,GAAA,CAAC,CAAC;iBAClD;gBAED,mCAAG,GAAH,UAAI,IAAc;oBAChB,IAAI,oBAAoB,GAAG,QAAQ,CAAC,GAAG,CAAC,QAAQ,CAAC,QAAQ,EAAE,IAAI,CAAyB,CAAC;oBACzF,IAAI,CAAC,oBAAoB,IAAI,EAAE,oBAAoB,YAAY,oBAAoB,CAAC,EAAE;wBACpF,OAAO,KAAK,CAAC;qBACd;oBACD,OAAO,IAAI,CAAC,OAAO,CAAC,SAAS,CAAC,oBAAoB,CAAC,CAAC,KAAK,SAAS,CAAC;iBACpE;gBA5FM,4BAAM,GAAG,CAAC,SAAS,EAAE,YAAY,EAAE,aAAa,CAAC,CAAC;gBA6F3D,4BAAC;aA/FD;;;;;;"}